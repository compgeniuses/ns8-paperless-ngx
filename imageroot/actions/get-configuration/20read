#!/usr/bin/env python3

#
# Copyright (C) 2023 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import os
import sys
import json
import agent

config = {}

# Read current configuration from Redis
env = f'module/{os.environ["MODULE_ID"]}/environment'
rdb = agent.redis_connect()
config["paperless_name"] = rdb.hget(env, "PAPERLESS_NGX_NAME")
config["PAPERLESS_SECRET_KEY"] = rdb.hget(env, "PAPERLESS_SECRET_KEY");
config["PAPERLESS_URL"] =  rdb.hget(env, "TRAEFIK_HOST");
config["http2https"] =  rdb.hget(env, "TRAEFIK_HTTP2HTTPS") == "True";
config["lets_encrypt"] =  rdb.hget(env, "TRAEFIK_LETS_ENCRYPT") == "True";
config["PAPERLESS_TIME_ZONE"] =  rdb.hget(env, "PAPERLESS_TIME_ZONE") == "America/Los_Angeles";
config["PAPERLESS_OCR_LANGUAGE"] =  rdb.hget(env, "PAPERLESS_OCR_LANGUAGE") == "eng";

json.dump(config, fp=sys.stdout)
